{"version":3,"file":"legacy.js","names":["commons","Status","getStatusFromError","isPromise","serialize","getLegacyApiRuntime","LegacyAllureApi","constructor","_defineProperty","epic","Promise","resolve","feature","story","name","suite","parentSuite","subSuite","value","label","options","parameter","url","type","link","issue","tms","markdown","description","html","descriptionHtml","owner","severity","layer","allureId","tag","info","_getLegacyApiRuntime","writeEnvironmentInfo","categories","_getLegacyApiRuntime2","writeCategoriesDefinitions","content","attachment","contentType","runtime","testAttachment","status","timestamp","Date","now","applyRuntimeMessages","data","start","PASSED","stop","body","result","renameStep","addStepParameter","then","v","stopStepSuccess","e","stopStepWithError","_getLegacyApiRuntime3","_getLegacyApiRuntime4","parameters","_getLegacyApiRuntime5","error","_getLegacyApiRuntime6","message","stack","statusDetails","trace","allure"],"sources":["../../src/legacy.ts"],"sourcesContent":["import * as commons from \"allure-js-commons\";\nimport type { ContentType, ParameterOptions } from \"allure-js-commons\";\nimport { Status } from \"allure-js-commons\";\nimport type { Category } from \"allure-js-commons/sdk\";\nimport { getStatusFromError, isPromise } from \"allure-js-commons/sdk\";\nimport { serialize } from \"allure-js-commons/sdk/reporter\";\nimport { getLegacyApiRuntime } from \"./legacyUtils.js\";\n\ninterface StepInterface {\n  parameter(name: string, value: string): void;\n\n  name(name: string): void;\n}\n\ninterface AttachmentOptions {\n  contentType: ContentType | string;\n  fileExtension?: string;\n}\n\n// noinspection JSDeprecatedSymbols\n/**\n * @deprecated please use api exported by \"allure-js-commons\" instead.\n */\nclass LegacyAllureApi {\n  /**\n   * @deprecated please use import { epic } from \"allure-js-commons\" instead.\n   */\n  epic = (epic: string) => Promise.resolve(commons.epic(epic));\n  /**\n   * @deprecated please use import { feature } from \"allure-js-commons\" instead.\n   */\n  feature = (feature: string) => Promise.resolve(commons.feature(feature));\n  /**\n   * @deprecated please use import { story } from \"allure-js-commons\" instead.\n   */\n  story = (story: string) => Promise.resolve(commons.story(story));\n  /**\n   * @deprecated please use import { suite } from \"allure-js-commons\" instead.\n   */\n  suite = (name: string) => Promise.resolve(commons.suite(name));\n  /**\n   * @deprecated please use import { parentSuite } from \"allure-js-commons\" instead.\n   */\n  parentSuite = (name: string) => Promise.resolve(commons.parentSuite(name));\n  /**\n   * @deprecated please use import { subSuite } from \"allure-js-commons\" instead.\n   */\n  subSuite = (name: string) => Promise.resolve(commons.subSuite(name));\n  /**\n   * @deprecated please use import { label } from \"allure-js-commons\" instead.\n   */\n  label = (name: string, value: string) => Promise.resolve(commons.label(name, value));\n  /**\n   * @deprecated please use import { parameter } from \"allure-js-commons\" instead.\n   */\n  parameter = (name: string, value: any, options?: ParameterOptions) =>\n    Promise.resolve(commons.parameter(name, serialize(value), options));\n  /**\n   * @deprecated please use import { link } from \"allure-js-commons\" instead.\n   */\n  link = (url: string, name?: string, type?: string) => Promise.resolve(commons.link(url, name, type));\n  /**\n   * @deprecated please use import { issue } from \"allure-js-commons\" instead.\n   */\n  issue = (name: string, url: string) => Promise.resolve(commons.issue(url, name));\n  /**\n   * @deprecated please use import { tms } from \"allure-js-commons\" instead.\n   */\n  tms = (name: string, url: string) => Promise.resolve(commons.tms(url, name));\n  /**\n   * @deprecated please use import { description } from \"allure-js-commons\" instead.\n   */\n  description = (markdown: string) => Promise.resolve(commons.description(markdown));\n  /**\n   * @deprecated please use import { descriptionHtml } from \"allure-js-commons\" instead.\n   */\n  descriptionHtml = (html: string) => Promise.resolve(commons.descriptionHtml(html));\n  /**\n   * @deprecated please use import { owner } from \"allure-js-commons\" instead.\n   */\n  owner = (owner: string) => Promise.resolve(commons.owner(owner));\n  /**\n   * @deprecated please use import { severity } from \"allure-js-commons\" instead.\n   */\n  severity = (severity: string) => Promise.resolve(commons.severity(severity));\n  /**\n   * @deprecated please use import { layer } from \"allure-js-commons\" instead.\n   */\n  layer = (layer: string) => Promise.resolve(commons.layer(layer));\n  /**\n   * @deprecated please use import { allureId } from \"allure-js-commons\" instead.\n   */\n  id = (allureId: string) => Promise.resolve(commons.allureId(allureId));\n  /**\n   * @deprecated please use import { tag } from \"allure-js-commons\" instead.\n   */\n  tag = (tag: string) => Promise.resolve(commons.tag(tag));\n  /**\n   * @deprecated please use the `environmentInfo` config option instead.\n   */\n  writeEnvironmentInfo = (info: Record<string, string>) => {\n    getLegacyApiRuntime()?.writeEnvironmentInfo(info);\n  };\n  /**\n   * @deprecated please use the `categories` config option instead.\n   */\n  writeCategoriesDefinitions = (categories: Category[]) => {\n    getLegacyApiRuntime()?.writeCategoriesDefinitions(categories);\n  };\n  /**\n   * @deprecated please use import { attachment } from \"allure-js-commons\" instead.\n   */\n  attachment = (name: string, content: Buffer | string, options: ContentType | string | AttachmentOptions) =>\n    Promise.resolve(\n      commons.attachment(name, content, typeof options === \"string\" ? { contentType: options } : options),\n    );\n  /**\n   * @deprecated please use import { attachment } from \"allure-js-commons\" instead.\n   */\n  testAttachment = (name: string, content: Buffer | string, options: ContentType | string | AttachmentOptions) => {\n    const runtime = getLegacyApiRuntime();\n    runtime.testAttachment(name, content, options);\n  };\n  /**\n   * @deprecated please use import { step } from \"allure-js-commons\" instead.\n   */\n  logStep = (name: string, status?: Status) => {\n    const runtime = getLegacyApiRuntime();\n    const timestamp = Date.now();\n    runtime?.applyRuntimeMessages(\n      {\n        type: \"step_start\",\n        data: {\n          name,\n          start: timestamp,\n        },\n      },\n      {\n        type: \"step_stop\",\n        data: {\n          status: status ?? Status.PASSED,\n          stop: timestamp,\n        },\n      },\n    );\n  };\n\n  // It's sync-first. That's why we can't simply reuse commons.step.\n  /**\n   * @deprecated please use import { step } from \"allure-js-commons\" instead.\n   */\n  step = <T>(name: string, body: (step: StepInterface) => T): T => {\n    const runtime = getLegacyApiRuntime();\n    runtime?.applyRuntimeMessages({\n      type: \"step_start\",\n      data: {\n        name,\n        start: Date.now(),\n      },\n    });\n    try {\n      const result = body({\n        name: this.renameStep,\n        parameter: this.addStepParameter,\n      });\n      if (isPromise(result)) {\n        return result.then(\n          (v) => {\n            this.stopStepSuccess();\n            return v;\n          },\n          (e) => {\n            this.stopStepWithError(e);\n            throw e;\n          },\n        ) as T;\n      }\n      this.stopStepSuccess();\n      return result;\n    } catch (e) {\n      this.stopStepWithError(e);\n      throw e;\n    }\n  };\n\n  private renameStep = (name: string) => {\n    getLegacyApiRuntime()?.applyRuntimeMessages({\n      type: \"step_metadata\",\n      data: { name },\n    });\n  };\n\n  private addStepParameter = (name: string, value: string) => {\n    getLegacyApiRuntime()?.applyRuntimeMessages({\n      type: \"step_metadata\",\n      data: {\n        parameters: [{ name, value }],\n      },\n    });\n  };\n\n  private stopStepSuccess = () => {\n    getLegacyApiRuntime()?.applyRuntimeMessages({\n      type: \"step_stop\",\n      data: {\n        status: Status.PASSED,\n        stop: Date.now(),\n      },\n    });\n  };\n\n  private stopStepWithError = (error: unknown) => {\n    const { message, stack } = error as Error;\n    getLegacyApiRuntime()?.applyRuntimeMessages({\n      type: \"step_stop\",\n      data: {\n        status: getStatusFromError(error as Error),\n        stop: Date.now(),\n        statusDetails: {\n          message,\n          trace: stack,\n        },\n      },\n    });\n  };\n}\n\nexport const allure = new LegacyAllureApi();\n"],"mappings":"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","ignoreList":[]}